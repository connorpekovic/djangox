{% extends '_base.html' %}
{% load static %}

{% block title %}Home page Data{% endblock title %}

{% block content %}

    <div class="py-2 mb-3" style="text-align: center; background-color: lightgreen;">
        This is simple a proof of competency website.  It uses Python Django to securely create, read, update and delete data.
        See the <a href="{% url 'about' %}"> about</a>  page.
    </div>

    <div class="container">

        
        <!-- Location -->
        <div class="container"> 
            <div class="row">
                <div class="col-md-4"></div>
                <div class="col-md-4" style="text-align: center;">
                    <label for="weatherLocationInputID">
                        <h3 class="mb-1"> Generate Weather Forcast </h3>
                    </label>
                    <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon3">Location</span>
                    </div>
                    <input type="text" class="form-control" id="weatherLocationInputID" aria-describedby="basic-addon3"> 

                    <!-- The Javascript for this function is defined inline below. -->
                    <button type="button" class="btn btn-primary" onclick="getLocalWeather()">Search</button>
                    </div>
                </div>
                <div class="col-md-4"></div>
            </div>
            <div>
                <!-- Where the weather is displayed -->
                <h2 style="text-align: center ;" id="tempature"></h2>
            </div>
        </div>  

        <div class="row">
            <div class="col-md-4">
                <!-- Call to action -->
                <div class="jumbotron">
                    <h1 class="display-5">What is your favorite season?</h1>
                    <p class="lead">Tell us what is your favorite season.</p>
                    <hr class="my-4">
                    <p>Vote on your favorite season.</p>
                    <p class="lead">
                        <a class="btn btn-primary btn-lg" href="{% url 'create' %}#" role="button">Vote Here</a>
                    </p>
                </div>
            </div>
            <div class="col-md-4">
                {% include 'pages/info/detail.html' %}
            </div>
            <div class="col-md-4" style="position: relative;">
                    
                        {% include 'pages/info/detailrest.html' %}
                </div>
                
            </div>
        </div>
    </div>

    <script>
        async function getLocalWeather() {
            
            var input = document.getElementById("weatherLocationInputID").value;
            
            /* Format the input */
            input = input.toLowerCase();

            /* Build the URL Query */
            let hostnamePath = 'https://api.openweathermap.org/data/2.5/weather?q='
            let appid = '&appid=a8efcfe69258b521961181dac55090ca'

            let getLocalWeatherCall = hostnamePath.concat(input, appid);

            /* The HTML Value element assignments will happen in the getTempature function */ 
            /* because I am having a hard time */
            getTempature(getLocalWeatherCall);
        }

        async function getTempature(getLocalWeatherCall) {
    
            // execute function, Storing response
            const response = await fetch(getLocalWeatherCall);
            console.log('Fetch initatiated')

            // Storing data in form of JSON
            var data = await response.json();
        
            if (response) {
                let K, F = 0
                K = data.main.temp
                F = ((K-273.15)*1.8)+32
                F = Math.round(F)
                console.log('InlineJS: Tempature is ', F)

                document.getElementById("tempature").innerHTML = F + "Â°F";

                return F  
            }

} 

    </script>

{% endblock content %}



